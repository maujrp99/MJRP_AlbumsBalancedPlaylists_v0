# VibeCoding — Local Dev Notes & Architecture

This repository contains a small static frontend (under `public/`) and a lightweight local proxy server (under `server/`) used to forward AI requests to a provider (Gemini / Google Generative Language) so API keys remain on the server and are not exposed to the browser.

This README documents the code layout, how the proxy works, how to run the project locally, and recommended security / git hygiene steps.

## Project layout

- `public/` — static site (HTML, extracted CSS and JS). Main entry: `public/index.html`.
  - `public/js/app.js` — main client application. It initializes Firebase (placeholder `YOUR_FIREBASE_API_KEY`) and calls the server proxy at `/api/generate` to obtain album metadata.
  - `public/css/style.css` — styles extracted from the original inline CSS.

- `server/` — small Express-based proxy used to call the AI provider.
  - `server/index.js` — implements `/api/generate`, `/api/list-models` and `/_health`. The server reads `AI_API_KEY`, `AI_ENDPOINT` and `AI_MODEL` from environment variables.
  - `server/package.json` — server dependencies (`axios`, `cors`, `dotenv`, `express`).

- `.env` (local, ignored) — contains `AI_API_KEY` and `AI_ENDPOINT`. Do NOT commit this file.
- `.env.example` — sanitized example with placeholders.
- `.gitignore` — ignores `.env`, `node_modules/`, lockfiles and other local artifacts.

## What the proxy does

- `/api/list-models` — helper to list available models from the configured endpoint (uses the API key passed via `?key=` for Google Generative Language endpoints).
- `/api/generate` — accepts JSON `{ albumQuery, model?, maxTokens? }` and forwards it to the configured AI endpoint.
  - If `AI_ENDPOINT` indicates Google Generative Language, the proxy builds a `generateContent` request calling an explicit model (defaults to `models/gemini-2.5-flash`) and attaches the API key as a query parameter.
  - The proxy attempts to normalize responses to return a single `data` object `{ data: <album> }` when the provider returns stringified JSON inside `candidates[0].content.parts[0].text` or when the provider returns an object with `tracks`.
  - On error, the proxy forwards provider error payloads with the appropriate HTTP status.

## Running locally (dev)

1. Install server deps:

```bash
cd server
npm install
cd ..
```

2. Create a local `.env` (this file must NOT be committed):

```text
AI_API_KEY=YOUR_REAL_KEY_HERE
AI_ENDPOINT=https://generativelanguage.googleapis.com/v1
AI_MODEL=models/gemini-2.5-flash
PORT=3000
```

3. Start the proxy:

```bash
cd server
node index.js
# or use nodemon in dev: npx nodemon index.js
```

4. Serve the `public/` directory (for example using a static server on port 8000):

```bash
# from repo root
python3 -m http.server 8000 -d public
```

5. Open `http://localhost:8000` and use the app; client calls `http://localhost:3000/api/generate` to request album metadata.

## Security & git hygiene

- The real `AI_API_KEY` must live in a local `.env` and that file should be in `.gitignore`.
- If any secrets were previously committed, follow the documented steps below to safely remove them from history. A non-destructive backup branch should be created first.

### Recommended cleanup workflow (manual review + backup)

1. Create a backup branch:

```bash
git branch pre-secrets-cleanup-backup
```

2. Inspect commits for secrets (example search):

```bash
git rev-list --all | xargs -n1 git grep -n "AIza" --line-number --no-index || true
```

3. Remove files from history using `git filter-repo` (recommended):

```bash
pip3 install git-filter-repo
git filter-repo --invert-paths --paths .env --paths .env.example
```

4. Run `git gc` and verify secrets are gone. Do NOT force-push to any shared remote until you coordinate with collaborators.

If `git filter-repo` is not available, `git filter-branch` can be used, but it is slower and deprecated.

## Notes and troubleshooting

- The proxy includes simple normalization logic but provider responses can vary. If you get back provider-specific shapes, consider adjusting the parsing heuristics in `server/index.js`.
- Provider may return 503 (model overloaded); add retries and exponential backoff on the client or within the proxy for better resiliency.

## Where to continue

- Task 3 (optional): rewrite git history to remove sensitive committed files (.env/.env.example). This is destructive and requires coordination for remote pushes. See the section above.

If you'd like, I can perform the safe, non-destructive steps now (create backup branch, add & commit safe files). I will not rewrite history or push anything to remotes without explicit confirmation.

---
Generated by developer tooling during a local refactor to extract client JS/CSS and add an AI request proxy. Keep secrets out of this repository.
